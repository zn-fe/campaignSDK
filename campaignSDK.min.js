(function(e,n,t){var i={};i.UA=function(){var n=navigator.userAgent.toLowerCase();var t={};t.inWdj=typeof e.campaignPlugin!=="undefined"&&e.campaignPlugin;t.inWechat=!!n.match(/micromessenger/);t.inIos=!!n.match(/(iphone|ipod|ipad)/);t.inAndroid=!!n.match(/(android)/);t.inWp=!!n.match(/(windows phone)/);t.inSymbian=!!n.match(/(symbianos)/);t.inMac=navigator.platform.indexOf("Mac")===0;t.inWindows=navigator.platform.indexOf("Win")===0;t.inIphone=!!n.match(/(iphone)/);t.inIpad=!!n.match(/(ipad)/);t.inMobile=t.inIos||t.inAndroid||t.inWp||t.inSymbian;t.inPC=!(t.inIos||t.inAndroid||t.inWp||t.inSymbian);t.isRetina=typeof e.campaignPlugin!=="undefined"&&e.devicePixelRatio>1;t.inWindow=t.inWindows;return t}();i.inPC=i.UA.inPC;if(i.UA.inWdj){var a=e.campaignPlugin;i.runSystemShare=function(e,n){e=e||"豌豆荚";n=n||"你的手机娱乐中心";a.share(e,n)};i.runAppShare=function(e,n,t,i,o){e=e||"豌豆荚";n=n||"你的手机娱乐中心";t=t||"http://static.wdjimg.com/www/images/www/p4.png";i=i||"http://www.wandoujia.com/";o=o||"SINA_WEIBO";a.shareTo(e,n,t,i,o)};i.openInBrowser=function(e){a.openInBrowser(e)};i.getUDID=function(){return a.getUDID()};i.getUID=function(){return a.getUID()};i.getAvatar=function(){return a.getAvatar()};i.getUserEmail=function(){return a.getUserEmail()};i.getNickName=function(){return a.getNickName()};i.getUserAuth=function(){return a.getUserAuth()};i.isLogin=function(){return a.isLogin()};i.getPhoneNumber=function(){return a.getPhoneNumber()};i.openUserDetail=function(e){a.openUserDetail(e)};i.isInstalled=function(e){return a.isInstalled(e)};i.isUpgradable=function(e){return a.isUpgradable(e)};i.getAppState=function(e){return a.getAppState(e)};i.getAppVersionCode=function(e){return a.getAppVersionCode(e)};i.getAppVersionName=function(e){return a.getAppVersionName(e)};i.openApp=function(e){a.openApp(e)};i.openAppDetail=function(e){a.openAppDetail(e)};i.openAppDetailWithoutAward=function(e){a.openAppDetailWithoutAward(e)};i.sendIntent=function(e){a.startActivity(e)};i.openVideoDetail=function(e){a.startActivity("wdj://detail/video/"+e+"?video_type=")};i.openEbookDetail=function(e){a.startActivity("wdj://detail/ebbok/"+e)};i.searchWords=function(e){a.startActivity("wdj://search?q="+e)};i.openSubscribeDetail=function(e,n){a.startActivity("wdj://detail/subscribe/publisher/"+n+"/"+e)};i.openSubscribeSubset=function(e){if(typeof a.openSubscribeSubset!=="undefined"){a.openSubscribeSubset(e)}else{var n="intent://subscribe.wandoujia.com/list/"+e+"#Intent;scheme=http;action=android.intent.action.MAIN;end";a.startActivity(n)}};i.loginAccount=function(){if(typeof i.loginAccount!=="undefined"){a.loginAccount()}else{a.startActivity("intent:#Intent;component=com.wandoujia.phoenix2/com.wandoujia.p4.account.activity.PhoenixAccountActivity;end")}};i.choseLoginAccount=function(){a.startActivity("intent://account.wandoujia.com/android/login#Intent;scheme=https;action=android.intent.action.MAIN;end")};i.installApp=function(e,t){var i=false;if(typeof a.installByPackage!==n){a.installByPackage(e.packageName);o({error:0,message:"安装成功"})}else{if(!e.packageName||!e.downloadUrl||!e.appName||!e.iconUrl){if(t&&typeof t==="function"){t({error:1,message:"缺少必要参数"})}}else{a.install(e.packageName,e.downloadUrl,e.appName,e.iconUrl,e.size);o({error:0,message:"安装成功"})}}function o(n){if(t&&typeof t==="function"){var o=setInterval(function(){i=a.isInstalled(e.packageName);if(i){clearInterval(o);o=0;t(n)}},1500)}}};i.reload=function(){a.reload()};i.setOrientation=function(e){a.setOrientation(e)};i.closeWebView=function(){a.closeWebView()};i.openNewWebView=function(e,n,t,i,o){e=e||"http://www.wandoujia.com";n=n||"豌豆荚";t=t||true;i=i||true;o=o||false;a.openNewWebView(e,n,t,i,o)};i.getVersionCode=function(){return a.getVersionCode()};i.getVersionName=function(){return a.getVersionName()};i.getFullVersionName=function(){return a.getFullVersionName()};i.getIMEI=function(){return a.getIMEI()};i.getBrand=function(){return a.getBrand()};i.getNetworkType=function(){return a.getNetworkType()};i.getLocaleLanguage=function(){return a.getLocaleLanguage()};i.getLocaleCountry=function(){return a.getLocaleCountry()};i.getSDKVersion=function(){return a.getSDKVersionInt()};i.setClipboardText=function(e){return a.setClipboardText(e)};i.toast=function(e){a.toast(e)}}i.constant={telReg:/^0?(13[0-9]|15[0-9]|18[0-9]|14[57]|17[0])[0-9]{8}$/};i.api={needle:"http://www.wandoujia.com/needle/source/",apps:"http://www.wandoujia.com/api/apps/apps",appsOptFields:"?opt_fields=title,icons.*,apks.*.size,apks.*.bytes,apks.*.downloadUrl.*.url,apks.*.creation,installedCountStr,apks.*.versionName,apks.*.versionCode",itemlist:"http://www.wandoujia.com/api/subscribe/itemlist/",subscribe:"http://www.wandoujia.com/api/subscribe/subscriber/subscribe",unsubscribe:"http://www.wandoujia.com/api/subscribe/subscriber/unsubscribe",subscribeStatus:"http://www.wandoujia.com/api/subscribe/publisher/ACCOUNT/"};i.getFeedListData=function(e,n){$.ajax({url:i.api.itemlist+e+"/summary",dataType:"json",success:function(e){if(n&&typeof n==="function"){n(e)}}})};i.getFeedItemsData=function(e,n){$.ajax({url:i.api.itemlist+e+"/item",dataType:"json",success:function(e){if(n&&typeof n==="function"){n(e)}}})};i.getSubscribeStatus=function(e,n){$.ajax({url:i.api.subscribeStatus+e,dataType:"json",success:function(e){if(n&&typeof n==="function"){n(e)}}})};i.subscribe=function(e,n){$.ajax({url:i.api.subscribe,dataType:"json",contentType:"application/json; charset=UTF-8",type:"POST",data:JSON.stringify([{type:"ACCOUNT",id:e}]),success:function(e){if(n&&typeof n==="function"){n(e)}}})};i.unsubscribe=function(e,n){var t=new XMLHttpRequest;t.open("POST",i.api.unsubscribe,false);t.send(JSON.stringify([{type:"ACCOUNT",id:e,wdj_auth:$.cookie("wdj_auth")}]));var a=t.getAllResponseHeaders().toLowerCase();if(t.status===200){if(n&&typeof n==="function"){n()}}};i.pushGaEvent=function(e,n,t,i){e=e||"";n=n||"";t=t||"";i=parseInt(i,10)||0;if(typeof ga!=="undefined"&&ga){ga("send","event",e,n,t,i)}else if(typeof _gaq!=="undefined"&&_gaq){_gaq.push(["_trackEvent",e,n,t,i])}};i.setFullScreenHeight=function(n){var t=e.innerHeight;n=n||480;if(t<n){setTimeout(function(){t=e.innerHeight;if(t<n){t=n}document.body.style.height=t+"px"},1e3)}else{document.body.style.height=t+"px"}};i.parseQueryString=function(){var n=e.location.search;var t={};n.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(e,n,i,a){t[n]=a});return t};i.wechatWebviewShareSetup=function(e,n){$.ajax({url:"http://who.wandoujia.com/wx-corp",type:"POST",data:{url:location.href.split("#")[0]}}).done(function(t){wx.config({debug:false,appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","hideMenuItems"]});wx.ready(function(){wx.onMenuShareTimeline({title:e.title,link:e.link,imgUrl:e.imgUrl,success:function(){if(e.successCallback&&typeof e.successCallback==="function"){e.successCallback()}},cancel:function(){}});wx.onMenuShareAppMessage({title:n.title,desc:n.desc,link:n.link,imgUrl:n.imgUrl,type:"",dataUrl:"",success:function(){if(n.successCallback&&typeof n.successCallback==="function"){n.successCallback()}},cancel:function(){}})})})};var o={weibo:[],wechatFriend:[],wechatTimeline:[]};var c=function(e,n){for(var t=n.length-1;t>=0;t--){if($(n[t].element)[0]===$(e)[0]){return n[t]}}return false};var s=function(e,n){var t=c(e.element,o[n]);if(t){for(var a in t){if(t.hasOwnProperty(a)){t[a]=e[a]}}return}if(!e.element){return}o[n].push(e);switch(n){case"weibo":$(document).on("click",e.element,function(){if(i.UA.inWdj){e.successCallback("P4-weibo-launch");i.toast("正在打开微博，请稍候...");i.runAppShare(null,e.desc,e.imgUrl,e.shortLink||e.link,"SINA_WEIBO")}else{var n="http://service.weibo.com/share/share.php?appkey=1483181040&relateUid=1727978503&url="+encodeURIComponent(e.shortLink||e.link)+"&title="+encodeURIComponent(e.desc)+"&pic="+e.imgUrl;e.successCallback("weibo-redirect");location.href=n}});break;case"wechatFriend":$(document).on("click",e.element,function(){if(i.UA.inWdj){e.successCallback("P4-wechatFriend-launch");i.toast("正在打开微信，请稍候...");i.runAppShare(e.title,e.desc,e.imgUrl,e.link,"WECHAT")}else if(i.UA.inWechat){e.successCallback("wechat-wechatFriend-tips");e.tips()}else{e.successCallback("other-wechatFriend-qrcode");e.qrcode()}});break;case"wechatTimeline":$(document).on("click",e.element,function(){if(i.UA.inWdj){e.successCallback("P4-wechatTimeline-launch");i.toast("正在打开微信，请稍候...");i.runAppShare(e.title,e.title,e.imgUrl,e.link,"WECHAT_TIMELINE")}else if(i.UA.inWechat){e.successCallback("wechat-wechatTimeline-tips");e.tips()}else{e.successCallback("other-wechatTimeline-qrcode");e.qrcode()}})}};i.shareButtonSetup=function(e,n,t){s(e,"weibo");s(n,"wechatFriend");s(t,"wechatTimeline")};var r=e.campaignTools;e.campaignTools=i;i.noConflict=function(){e.campaignTools=r;return i};if(typeof t==="function"&&t.amd){t("campaignTools",[],function(){return i})}})(this);
